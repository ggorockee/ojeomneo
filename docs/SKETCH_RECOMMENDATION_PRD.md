# 스케치 기반 메뉴 추천 기능 기획안

> 오점너(Ojeomneo) - "오늘 점심 뭐 먹지?"를 해결하는 감성 메뉴 추천 앱

---

## 1. 개요

### 1.1 프로젝트 배경

매일 반복되는 "오늘 뭐 먹지?" 고민을 재미있게 해결하고자 함. 기존 메뉴 추천 앱들이 데이터 기반의 정확한 추천에 집중하는 반면, 오점너는 **사용자의 현재 감정과 분위기**에 맞는 메뉴를 추천하는 새로운 접근 방식을 제안.

### 1.2 핵심 가치 제안

| 기존 서비스 | 오점너 |
|------------|--------|
| 위치/평점 기반 추천 | 감정/분위기 기반 추천 |
| 텍스트 검색 입력 | 자유로운 스케치 입력 |
| 정확한 데이터 분석 | 재미있는 AI 해석 |
| 실용성 중심 | 엔터테인먼트 + 실용성 |

**핵심 컨셉**: "정확한 추천"보다 "재미있는 경험"

### 1.3 타겟 사용자

| 타겟 | 특징 | 주요 니즈 |
|------|------|----------|
| MZ세대 직장인 | 점심 메뉴 결정 스트레스 | 빠르고 재미있는 메뉴 선택 |
| 대학생 | SNS 콘텐츠 생산 욕구 | 공유할 수 있는 재미있는 결과 |
| 커플/친구 그룹 | 메뉴 선택 갈등 | 중립적인 AI 추천으로 결정 |

---

## 2. 핵심 기능

### 2.1 스케치 입력

사용자가 현재 기분이나 상태를 자유롭게 표현할 수 있는 캔버스 제공.

**입력 방식**:

| 방식 | 설명 | 예시 |
|------|------|------|
| 자유 드로잉 | 터치로 그림/낙서 | 구불구불한 선, 얼굴 표정 |
| 텍스트 입력 | 현재 기분을 글로 표현 | "오늘 너무 피곤해..." |
| 이모지 선택 | 미리 정의된 감정 아이콘 | 😫😊🥺🔥 |
| 혼합 모드 | 그림 + 텍스트 조합 | 낙서 위에 한줄 코멘트 |

### 2.2 AI 분석

Vision LLM을 활용하여 스케치에서 감정과 분위기를 추출.

**분석 결과**:

| 항목 | 설명 |
|------|------|
| 감정 | 피곤함, 설렘, 우울함, 행복함, 스트레스 등 |
| 키워드 | 연상되는 3개 키워드 (따뜻함, 시원함, 매콤함 등) |
| 분위기 | 전반적인 톤 (밝음, 어두움, 중립) |

### 2.3 메뉴 추천

분석 결과를 기반으로 어울리는 메뉴와 감성적인 추천 이유 제공.

**추천 결과 구성**:

| 요소 | 설명 |
|------|------|
| 메뉴 이름 | 추천 음식 (예: 된장찌개) |
| 메뉴 이미지 | 식욕 자극 비주얼 |
| 추천 이유 | 감성적 문구 ("지친 하루 끝에 따뜻한 국물 한 숟갈...") |
| 대안 메뉴 | 2순위, 3순위 추천 |

---

## 3. 사용자 시나리오

### 3.1 메인 플로우

```
[앱 실행] → [스케치 화면] → [그림 그리기] → [추천받기 탭]
    → [로딩 애니메이션] → [결과 카드] → [저장/공유/다시하기]
```

**상세 단계**:

| 단계 | 화면 | 사용자 행동 | 시스템 반응 |
|------|------|------------|------------|
| 1 | 스플래시 | 앱 실행 | 로고 애니메이션 |
| 2 | 스케치 캔버스 | 화면 터치 시작 | 드로잉 모드 활성화 |
| 3 | 스케치 캔버스 | 자유롭게 그림 | 실시간 선 렌더링 |
| 4 | 스케치 캔버스 | "추천받기" 버튼 탭 | 이미지 캡처 및 서버 전송 |
| 5 | 로딩 화면 | 대기 | AI 분석 진행 (재미있는 문구) |
| 6 | 결과 화면 | 결과 확인 | 메뉴 카드 + 추천 이유 표시 |
| 7 | 결과 화면 | 저장/공유/다시 | 히스토리 저장 또는 SNS 공유 |

### 3.2 대체 플로우

**플로우 A - 텍스트 입력**:
스케치 대신 텍스트로 현재 기분 입력 → 동일한 AI 분석 → 결과

**플로우 B - 빠른 선택**:
이모지 3개 선택 → 즉시 추천 (Vision API 미사용으로 빠른 응답)

**플로우 C - 히스토리 재사용**:
이전 결과 확인 → "다시 추천받기" → 같은 스케치로 새로운 결과

---

## 4. 기술 아키텍처

### 4.1 시스템 구성

```
┌─────────────────────────────────────────────────────────────┐
│                        Mobile (Flutter)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   Sketch    │  │   Result    │  │      History        │  │
│  │   Canvas    │  │   Card      │  │      Screen         │  │
│  └──────┬──────┘  └──────▲──────┘  └──────────▲──────────┘  │
└─────────┼────────────────┼─────────────────────┼────────────┘
          │ POST           │ Response            │ GET
          │ /sketch/analyze│                     │ /sketch/history
          ▼                │                     │
┌─────────────────────────────────────────────────────────────┐
│                      Server (Go Fiber)                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   Sketch    │  │   Menu      │  │      LLM            │  │
│  │   Handler   │──│   Matcher   │──│      Client         │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
└─────────┼────────────────┼─────────────────────┼────────────┘
          │                │                     │
          ▼                ▼                     ▼
┌──────────────┐  ┌──────────────┐      ┌──────────────┐
│  PostgreSQL  │  │    Redis     │      │  OpenAI API  │
│  (메뉴 DB)   │  │   (캐시)     │      │  (Vision)    │
└──────────────┘  └──────────────┘      └──────────────┘
```

### 4.2 API 설계

#### 스케치 분석 API

| 항목 | 값 |
|------|-----|
| Endpoint | `POST /ojeomneo/v1/sketch/analyze` |
| Content-Type | `multipart/form-data` |

**Request**:

| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| image | File | O | 스케치 이미지 (PNG/JPEG) |
| text | String | X | 추가 텍스트 입력 |
| mode | String | X | quick/standard/detailed |

**Response**:

```json
{
  "success": true,
  "data": {
    "sketch_id": "uuid",
    "analysis": {
      "emotion": "피곤하고 위로받고 싶은",
      "keywords": ["따뜻함", "포근함", "집밥"],
      "mood": "calm"
    },
    "recommendation": {
      "primary": {
        "menu_id": 1,
        "name": "된장찌개",
        "image_url": "https://...",
        "reason": "지친 하루 끝에 따뜻한 국물 한 숟갈은 마음까지 녹여줄 거예요",
        "tags": ["한식", "국물", "따뜻함"]
      },
      "alternatives": [
        {"menu_id": 2, "name": "칼국수", "reason": "..."},
        {"menu_id": 3, "name": "김치찌개", "reason": "..."}
      ]
    },
    "created_at": "2024-01-15T12:00:00Z"
  }
}
```

#### 히스토리 조회 API

| 항목 | 값 |
|------|-----|
| Endpoint | `GET /ojeomneo/v1/sketch/history` |
| Auth | Bearer Token |

**Query Parameters**:

| 필드 | 타입 | 설명 |
|------|------|------|
| page | Int | 페이지 번호 |
| limit | Int | 페이지당 개수 |

### 4.3 데이터 모델

#### Menu 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | BIGINT | PK |
| name | VARCHAR(100) | 메뉴명 |
| category | VARCHAR(50) | 카테고리 (한식, 중식, 양식 등) |
| image_url | TEXT | 이미지 URL |
| emotion_tags | TEXT[] | 감정 태그 배열 |
| situation_tags | TEXT[] | 상황 태그 배열 |
| attribute_tags | TEXT[] | 특성 태그 배열 |
| is_active | BOOLEAN | 활성화 여부 |
| created_at | TIMESTAMP | 생성일시 |
| updated_at | TIMESTAMP | 수정일시 |

#### Sketch 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | UUID | PK |
| user_id | BIGINT | FK → users |
| image_path | TEXT | 스케치 이미지 저장 경로 |
| input_text | TEXT | 추가 텍스트 입력 |
| analysis_result | JSONB | LLM 분석 결과 |
| created_at | TIMESTAMP | 생성일시 |

#### Recommendation 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | BIGINT | PK |
| sketch_id | UUID | FK → sketches |
| menu_id | BIGINT | FK → menus |
| reason | TEXT | 추천 이유 |
| rank | INT | 추천 순위 (1, 2, 3) |
| created_at | TIMESTAMP | 생성일시 |

---

## 5. LLM 연동 전략

### 5.1 프롬프트 설계

**시스템 프롬프트**:

```
당신은 감성적인 음식 추천가입니다. 사용자가 그린 그림이나 낙서를 보고
그 순간의 기분, 감정, 분위기를 따뜻하게 읽어주세요.

정확한 분석보다는 공감과 위로를 담은 해석을 해주세요.
추천 이유는 친근하고 감성적인 문체로 작성해주세요.
```

**분석 요청 프롬프트**:

```
이 그림을 보고 다음을 분석해주세요:

1. 그림에서 느껴지는 감정 (한 문장)
2. 연상되는 키워드 3개
3. 분위기 (bright/calm/dark 중 하나)

JSON 형식으로 응답:
{"emotion": "...", "keywords": [...], "mood": "..."}
```

**추천 생성 프롬프트**:

```
감정: {emotion}
키워드: {keywords}

위 상태의 사람에게 어울리는 음식으로 "{menu_name}"을 추천합니다.
왜 이 음식이 어울리는지 2문장 이내로 따뜻하게 설명해주세요.
```

### 5.2 메뉴 매칭 로직

**태그 유사도 기반 매칭**:

| 단계 | 처리 |
|------|------|
| 1 | LLM에서 감정/키워드 추출 |
| 2 | 키워드 → 태그 매핑 (유사어 사전) |
| 3 | 메뉴 태그와 코사인 유사도 계산 |
| 4 | 상위 5개 후보 선정 |
| 5 | LLM이 최종 3개 선택 + 이유 생성 |

**키워드-태그 매핑 예시**:

| 추출 키워드 | 매핑 태그 |
|------------|----------|
| 따뜻함, 포근함 | 국물, 따뜻한, 한식 |
| 시원함, 청량 | 냉면, 시원한, 면류 |
| 매콤함, 화끈 | 매운, 자극적, 중식 |
| 달콤함, 보상 | 디저트, 달콤한, 카페 |

### 5.3 비용 최적화

| 전략 | 설명 | 예상 효과 |
|------|------|----------|
| 이미지 리사이징 | 512x512로 압축 후 전송 | 토큰 50% 절감 |
| 응답 캐싱 | 유사 키워드 조합 캐싱 | 반복 요청 80% 절감 |
| 하이브리드 모드 | 이모지 선택 시 Vision 미사용 | API 호출 30% 절감 |
| Rate Limiting | 사용자당 일 10회 제한 | 남용 방지 |

---

## 6. 개발 로드맵

### Phase 1 - MVP

**목표**: 핵심 기능 동작 확인

| 구분 | 항목 |
|------|------|
| Mobile | 스케치 캔버스, 결과 화면, 기본 UI |
| Server | 스케치 분석 API, LLM 연동, 기본 메뉴 50개 |
| Admin | 메뉴 CRUD |

**산출물**:
- 동작하는 앱 프로토타입
- 기본 메뉴 데이터셋
- LLM 프롬프트 v1

### Phase 2 - 확장

**목표**: 사용자 경험 강화

| 구분 | 항목 |
|------|------|
| Mobile | 히스토리, SNS 공유, 즐겨찾기, 온보딩 |
| Server | 히스토리 API, 캐싱 적용, 메뉴 200개 |
| Admin | 메뉴 태그 관리, 통계 대시보드 |

**산출물**:
- 완성도 있는 앱
- 공유 카드 생성 기능
- 사용 통계 수집

### Phase 3 - 고도화

**목표**: 차별화 및 수익화

| 구분 | 항목 |
|------|------|
| Mobile | 위치 기반 맛집 연동, 그룹 추천, 프리미엄 |
| Server | 개인화 추천, 날씨/시간대 반영, 광고 API |
| Admin | A/B 테스트, 추천 성능 분석 |

**산출물**:
- 맛집 제휴 연동
- 프리미엄 기능 (무제한 추천)
- 광고 수익 모델

---

## 7. 리스크 및 대응

| 리스크 | 영향 | 대응 방안 |
|--------|------|----------|
| LLM API 비용 급증 | 운영비 증가 | 캐싱 강화, 사용량 제한, 프리미엄 전환 |
| 응답 지연 (>5초) | UX 저하 | 스트리밍 응답, 스켈레톤 UI, 캐싱 |
| 부적절한 그림 입력 | 서비스 악용 | 콘텐츠 필터링 API 적용 |
| 추천 품질 불만족 | 이탈률 증가 | A/B 테스트, 프롬프트 개선, 피드백 수집 |
| 메뉴 데이터 부족 | 반복 추천 | 초기 100개 이상 확보, 지속 추가 |

---

## 8. 성공 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| DAU | MVP 후 1개월 내 1,000명 | Firebase Analytics |
| 세션당 추천 횟수 | 평균 2회 이상 | 서버 로그 |
| SNS 공유율 | 추천 결과의 10% | 공유 버튼 클릭 추적 |
| 재방문율 | 7일 후 30% | 코호트 분석 |
| 평균 응답 시간 | 3초 이내 | APM 모니터링 |

---

## 부록: 메뉴 태그 체계

### 감정 태그

| 태그 | 설명 | 연관 메뉴 예시 |
|------|------|---------------|
| 위로 | 힘들고 지칠 때 | 된장찌개, 칼국수, 죽 |
| 활력 | 에너지가 필요할 때 | 삼겹살, 치킨, 스테이크 |
| 청량 | 시원함이 필요할 때 | 냉면, 아이스커피, 빙수 |
| 보상 | 나를 위한 선물 | 초밥, 케이크, 파스타 |
| 평온 | 차분한 기분일 때 | 샐러드, 샌드위치, 차 |

### 상황 태그

| 태그 | 설명 |
|------|------|
| 혼밥 | 혼자 먹기 좋은 |
| 데이트 | 분위기 있는 |
| 회식 | 여럿이 나눠먹는 |
| 야식 | 늦은 밤에 어울리는 |
| 해장 | 술 다음날 |

### 특성 태그

| 태그 | 설명 |
|------|------|
| 따뜻한 | 온도가 따뜻한 |
| 시원한 | 온도가 차가운 |
| 매운 | 매운맛 |
| 달콤한 | 단맛 |
| 든든한 | 포만감 |
| 가벼운 | 칼로리 낮은 |
